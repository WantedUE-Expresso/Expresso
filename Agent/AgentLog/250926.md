# Expresso 250926

## End Log
- 20250926 18:09
- 작업자 : VaVamVa

### 오늘 한 일

1. **WebSocket 시스템 완전 전환**
   - FSocket TCP 방식에서 UE WebSocket Module로 완전 대체
   - Protocol://IP:Port/path/{property} URL 조립 시스템 구현
   - `ws://172.16.20.152:8000/chat/aaa` 형태로 WebSocket 연결

2. **확장 가능한 FSM 상태 관리 시스템 구축**
   - ESocketNetworkState enum으로 연결/게임세션/오류 상태 통합 관리
   - FScopeLock + FCriticalSection으로 스레드 안전한 상태 전환
   - 향후 게임 세션 확장을 위한 Authenticating, InLobby, InGame 등 상태 준비

3. **Runnable 멀티태스크 구조 개선**
   - FSocketReceiveWorker WebSocket 연동 완성
   - 위험한 [&] 람다 캡처를 안전한 [this] 패턴으로 수정
   - bAutoDeleteSelf = true 패턴으로 안전한 메모리 관리

4. **Blueprint 호환성 문제 해결**
   - UHT TSharedPtr 오류: C++/Blueprint 함수 분리로 해결
   - SendJsonMessage() (C++ 전용) / SendJsonString() (Blueprint 호환)
   - CallInEditor 지원으로 에디터에서 직접 테스트 가능

5. **기술적 문제 해결**
   - Cast<FSocketReceiveWorker> 잘못된 사용법 수정
   - GetRunnable() API 부재 (UE 5.6.1) 우회
   - FRunnable 메모리 관리 오해 정정 (UE 객체 아닌 일반 C++ 클래스)

### Commit 정보
"Complete WebSocket migration and FSM implementation for MetaHuman facial comparison system"

1. **Network System Refactoring**
   - Replace FSocket with UE WebSocket Module implementation
   - Implement Protocol://IP:Port/path/{property} URL assembly system
   - Add thread-safe FSM state management with ESocketNetworkState enum

2. **Thread Safety and Memory Management**
   - Fix dangerous lambda capture patterns ([&] → [this])
   - Implement bAutoDeleteSelf pattern for FRunnableThread cleanup
   - Add FCriticalSection for thread-safe state transitions

3. **Blueprint Integration**
   - Resolve UHT TSharedPtr exposure errors
   - Separate C++ and Blueprint-compatible message sending functions
   - Add CallInEditor support for development testing

4. **Production Ready Features**
   - Extensible game session state management (Authenticating, InLobby, InGame)
   - Flexible JSON processing (single object/array support)
   - Comprehensive error handling and logging system